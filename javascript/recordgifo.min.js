let comenzar=document.getElementsByClassName("comenzar")[0],paso1=document.getElementsByClassName("paso1")[0],paso2=document.getElementsByClassName("paso2")[0],maintitle=document.getElementsByClassName("maintitle")[0],mainp=document.getElementsByClassName("mainp")[0];var stream=null;async function firststep(){console.log("first step");try{const constraints={audio:!1,video:!0};paso1.src="Assets/paso-a-paso-hover.svg",comenzar.classList.add("showme"),maintitle.innerHTML="¿Nos das acceso a tu cámara?",mainp.innerHTML="El acceso a tu camara será válido sólo por el tiempo en el que estés creando el GIFO.",stream=await navigator.mediaDevices.getUserMedia(constraints),comenzar.removeEventListener("click",firststep),playvideo()}catch{console.error("error here")}}comenzar.addEventListener("click",firststep);let video=document.getElementsByClassName("video")[0],comenzarButtonText=document.getElementsByClassName("comenzarinnertext")[0];function playvideo(){console.log("%csecond step","color:blue;"),paso1.src="Assets/paso-a-paso.svg",paso2.src="Assets/paso-a-paso2-hover.svg",maintitle.innerHTML="",mainp.innerHTML="",video.setAttribute("style","display:block;"),video.srcObject=stream,video.play(),comenzarButtonText.innerHTML="GRABAR",comenzar.classList.remove("showme"),comenzar.addEventListener("click",record)}let videoRecorded=document.getElementsByClassName("recorded")[0],timer=document.getElementsByClassName("timer")[0];async function record(){var recorder=null;comenzar.removeEventListener("click",record),(recorder=RecordRTC(stream,{type:"gif",frameRate:1,quality:10,width:360,hidden:240,onGifRecordingStarted:function(){console.log("started")}})).startRecording(),runtimer();const sleep=m=>new Promise(r=>setTimeout(r,m));await sleep(3e3),await recorder.stopRecording();var blobfile=await recorder.getBlob();function sendToUpload(){var form=new FormData;form.append("file",blobfile,"myGif.gif"),comenzar.removeEventListener("click",sendToUpload),timer.removeEventListener("click",reset),console.log("lts see if its the same form "+form.get("file")),uploadGif(form),form.delete("file")}function reset(){videoRecorded.src="",comenzar.removeEventListener("click",sendToUpload),timer.removeEventListener("click",reset),videoRecorded.setAttribute("style","display:none;"),timer.innerHTML="",firststep()}console.log(blobfile),videoRecorded.src=window.URL.createObjectURL(blobfile),videoRecorded.setAttribute("style","display:block;"),video.src="",stream.getTracks()[0].stop(),video.pause(),comenzarButtonText.innerHTML="FINALIZAR",comenzar.addEventListener("click",sendToUpload),timer.addEventListener("click",reset)}function runtimer(){timer.innerHTML="0:03",timer.setAttribute("style","display:block;");var totalSeconds=3;let setTimer=setInterval(setTime,1e3);function setTime(){--totalSeconds,timer.innerHTML="0:0"+totalSeconds,0===totalSeconds&&(clearInterval(setTimer),timer.innerHTML="REPETIR CAPTURA")}}let paso3=document.getElementsByClassName("paso3")[0],loading=document.getElementsByClassName("preloader")[0];async function uploadGif(sendform){paso2.src="Assets/paso-a-paso2.svg",paso3.src="Assets/paso-a-paso3-hover.svg",timer.innerHTML="Estamos subiendo tu gifo...",loading.setAttribute("style","display:block;"),comenzarButtonText.innerHTML="REPITE";const APIkey2="bqYEWvblUOmRhEaNR9NoUmWCxOFmXQm0";var urlupload="https://upload.giphy.com/v1/gifs?api_key="+APIkey2;let request=await fetch(urlupload,{method:"POST",body:sendform}),response,gifid=(await request.json()).data.id;var giphyApiURL=`https://api.giphy.com/v1/gifs/${gifid}?api_key=${APIkey2}`,fetchreq=await fetch(giphyApiURL),requestres;let imgPathmisgifos=(await fetchreq.json()).data.images.downsized_medium.url+" title mygif idcardgif "+gifid;function again(){loading.setAttribute("style","display:none;"),videoRecorded.classList.remove("bgpurple"),videoRecorded.setAttribute("style","display:none;"),comenzar.removeEventListener("click",again),timer.innerHTML="",paso3.src="Assets/paso-a-paso3.svg",firststep()}idlist.push(imgPathmisgifos),console.log("this is the new list "+idlist),localStorage.setItem("misgifos",JSON.stringify(idlist)),console.log("este es el local "+JSON.parse(localStorage.getItem("misgifos"))),imgPathmisgifos="",blobfile="",gifid="",timer.innerHTML="Gifo subido con éxito",loading.setAttribute("style","display:none;"),comenzar.addEventListener("click",again)}