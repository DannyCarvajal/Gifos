const comenzar=document.getElementsByClassName("comenzar")[0],paso1=document.getElementsByClassName("paso1")[0],paso2=document.getElementsByClassName("paso2")[0],maintitle=document.getElementsByClassName("maintitle")[0],mainp=document.getElementsByClassName("mainp")[0];var stream=null;async function firststep(){try{const constraints={audio:!1,video:!0};paso1.src="Assets/paso-a-paso-hover.svg",comenzar.classList.add("showme"),maintitle.innerHTML="¿Nos das acceso a tu cámara?",mainp.innerHTML="El acceso a tu camara será válido sólo por el tiempo en el que estés creando el GIFO.",stream=await navigator.mediaDevices.getUserMedia(constraints),comenzar.removeEventListener("click",firststep),playvideo()}catch(error){console.error("error here "+error)}}comenzar.addEventListener("click",firststep);const video=document.getElementsByClassName("video")[0],comenzarButtonText=document.getElementsByClassName("comenzarinnertext")[0];function playvideo(){paso1.src="Assets/paso-a-paso.svg",paso2.src="Assets/paso-a-paso2-hover.svg",maintitle.innerHTML="",mainp.innerHTML="",video.setAttribute("style","display:block;"),video.srcObject=stream,video.play(),comenzarButtonText.innerHTML="GRABAR",comenzar.classList.remove("showme"),comenzar.addEventListener("click",record)}const videoRecorded=document.getElementsByClassName("recorded")[0],timer=document.getElementsByClassName("timer")[0];async function record(){var recorder=null;comenzar.removeEventListener("click",record),(recorder=RecordRTC(stream,{type:"gif",frameRate:1,quality:10,width:360,hidden:240,onGifRecordingStarted:function(){console.log("started")}})).startRecording(),runtimer();const sleep=m=>new Promise(r=>setTimeout(r,m));await sleep(3e3),await recorder.stopRecording();var blobfile=await recorder.getBlob();function sendToUpload(){var form=new FormData;form.append("file",blobfile,"myGif.gif"),comenzar.removeEventListener("click",sendToUpload),timer.removeEventListener("click",reset),uploadGif(form),form.delete("file")}videoRecorded.src=window.URL.createObjectURL(blobfile),videoRecorded.setAttribute("style","display:block;"),video.src="",stream.getTracks()[0].stop(),video.pause(),comenzarButtonText.innerHTML="FINALIZAR",comenzar.addEventListener("click",sendToUpload);const reset=()=>{videoRecorded.src="",comenzar.removeEventListener("click",sendToUpload),timer.removeEventListener("click",reset),videoRecorded.setAttribute("style","display:none;"),timer.innerHTML="",firststep()};timer.addEventListener("click",reset)}function runtimer(){timer.innerHTML="0:03",timer.setAttribute("style","display:block;");let totalSeconds=3,setTimer=setInterval(setTime,1e3);function setTime(){--totalSeconds,timer.innerHTML="0:0"+totalSeconds,0===totalSeconds&&(clearInterval(setTimer),timer.innerHTML="REPETIR CAPTURA")}}const paso3=document.getElementsByClassName("paso3")[0],loading=document.getElementsByClassName("preloader")[0];async function uploadGif(sendform){paso2.src="Assets/paso-a-paso2.svg",paso3.src="Assets/paso-a-paso3-hover.svg",timer.innerHTML="Estamos subiendo tu gifo...",loading.setAttribute("style","display:block;"),comenzarButtonText.innerHTML="REPITE";var urlupload="https://upload.giphy.com/v1/gifs?api_key="+APIkey1;let request=await fetch(urlupload,{method:"POST",body:sendform}),response,gifid=(await request.json()).data.id,giphyApiURL=`https://api.giphy.com/v1/gifs/${gifid}?api_key=${APIkey1}`,fetchreq=await fetch(giphyApiURL),responseData=await fetchreq.json();const getRandomNumber=(min,max)=>Math.floor(Math.random()*(max-min+1)+min);let random=["beautiful","amazing","best","thrilling","creepy","self","cool","chill","amazingly wonderful","palper"],randomname=random[getRandomNumber(0,random.length-1)];responseData.data.title=`my ${randomname} gif`;let infoStorage=JSON.parse(modelStorage(responseData.data));function again(){loading.setAttribute("style","display:none;"),videoRecorded.classList.remove("bgpurple"),videoRecorded.setAttribute("style","display:none;"),comenzar.removeEventListener("click",again),timer.innerHTML="",paso3.src="Assets/paso-a-paso3.svg",firststep()}myGifList.push(infoStorage),localStorage.setItem("misgifos",JSON.stringify(myGifList)),imgPathmisgifos="",blobfile="",gifid="",timer.innerHTML="Gifo subido con éxito",loading.setAttribute("style","display:none;"),comenzar.addEventListener("click",again)}